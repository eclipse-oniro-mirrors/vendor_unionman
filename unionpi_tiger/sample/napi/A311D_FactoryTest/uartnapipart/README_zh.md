# UART厂测

## napi

### 接口函数

   \* device_num为0 ：ttl设备

   \* device_num为1 ：40pin设备

   \* device_num为2 ：485设备

```tsx
function UM_uart_test(device_num: number): Promise<number>
```

### 返回值对应事件

```c
#define UART_SUCCESS 0 //串口测试成功
#define UART_TERMINAL_ERROR -1 //device_num不为0、1、2
#define UART_OPEN_FAIL -2 //设备节点打开失败
#define UART_INIT_FAIL -3 //串口初始化失败
#define UART_WRITE_FAIL -4 //写串口操作失败
#define UART_READ_FAIL -5 //读串口操作失败
#define UART_READ_ERROR -6 //读取的数据不是test
```

## 485接线

485小板的**GND**接开发板485接口**GND**

485小板的**RXD+**接开发板的**RS485_B**



## 使应用端获取设备节点访问权限

需要修改源码对应目录下的规则文件

在对应位置添加上：KERNEL==”ttyUSB[0-9]*|ttyACM[0-9]*”,MODE=”0666”

```shell
./foundation/multimodalinput/input/patch/prebuild_eudev/rules.d/60-serial.rules
```

```shell
do not edit this file, it will be overwritten on update

ACTION=="remove", GOTO="serial_end"
SUBSYSTEM!="tty", GOTO="serial_end"

SUBSYSTEMS=="pci", ENV{ID_BUS}="pci", ENV{ID_VENDOR_ID}="$attr{vendor}", ENV{ID_MODEL_ID}="$attr{device}"
SUBSYSTEMS=="pci", IMPORT{builtin}="hwdb --subsystem=pci"
SUBSYSTEMS=="usb", IMPORT{builtin}="usb_id", IMPORT{builtin}="hwdb --subsystem=usb"
#/dev/serial/by-path/, /dev/serial/by-id/ for USB devices
KERNEL!="ttyUSB[0-9]*|ttyACM[0-9]*", GOTO="serial_end"
KERNEL==”ttyUSB[0-9]*|ttyACM[0-9]*”,MODE=”0666”//在此位置添加权限设置命令
SUBSYSTEMS=="usb-serial", ENV{.ID_PORT}="$attr{port_number}"

IMPORT{builtin}="path_id"
ENV{ID_PATH}=="?*", ENV{.ID_PORT}=="", SYMLINK+="serial/by-path/$env{ID_PATH}"
ENV{ID_PATH}=="?*", ENV{.ID_PORT}=="?*", SYMLINK+="serial/by-path/$env{ID_PATH}-port$env{.ID_PORT}"

IMPORT{builtin}="usb_id"
ENV{ID_SERIAL}=="", GOTO="serial_end"
SUBSYSTEMS=="usb", ENV{ID_USB_INTERFACE_NUM}="$attr{bInterfaceNumber}"
ENV{ID_USB_INTERFACE_NUM}=="", GOTO="serial_end"
ENV{.ID_PORT}=="", SYMLINK+="serial/by-id/$env{ID_BUS}-$env{ID_SERIAL}-if$env{ID_USB_INTERFACE_NUM}"
ENV{.ID_PORT}=="?*", SYMLINK+="serial/by-id/$env{ID_BUS}-$env{ID_SERIAL}-if$env{ID_USB_INTERFACE_NUM}-port$env{.ID_PORT}"

LABEL="serial_end"
```



