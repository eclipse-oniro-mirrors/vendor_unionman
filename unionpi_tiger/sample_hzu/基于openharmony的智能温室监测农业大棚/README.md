
# 基于OpenHarmony的智能温室监测农业大棚系统

## 功能概述

1. **温度监测与报警**  
   利用热敏传感器实时监测农业植物环境温度。当温度超过设定阈值（30摄氏度）时，触发警报灯（GPIO1控制的LED灯）亮起，提醒用户温度过高。

2. **光照强度检测与补光**  
   使用光敏传感器检测环境光线强度。当光线强度不足时，触发灯光（GPIO2控制的LED灯）亮起，提高大棚内亮度。

---

## 实验所需知识与技术

- **传感器接口与工作原理**  
  热敏和光敏电阻的电压变化与ADC值的对应关系。

- **开发环境配置**  
  Tiger4.0版本的OpenHarmony系统环境配置及全量编译。

- **驱动与内核开发**  
  传感器的驱动代码开发以及模块加载。

- **ADC通信协议**  
  实现传感器的电压采集及其数据处理。

- **硬件调试与故障排查**  
  包括GPIO引脚的控制、传感器数据采集验证等。

---

## 系统实现内容

### 1. 环境配置

- 配置 **Tiger4.0** 版本的开发环境。
- 完成全量编译，确保系统模块正常运行。

---

### 2. 传感器驱动代码

#### 温度传感器

- **原理**  
  利用热敏电阻的电阻值随温度变化导致电压变化的特性。

- **连接方式**  
  通过 ADC1 通道与 Tiger 板相连接。

- **代码实现**  
  使用 `um_adc` 模块读取 ADC1 的电压值，转换为温度数据。

#### 光敏传感器

- **原理**  
  利用光敏电阻的电阻值随光强变化导致电压变化的特性。

- **连接方式**  
  通过 ADC2 通道与 Tiger 板相连接。

- **代码实现**  
  使用 `um_adc` 模块读取 ADC2 的电压值，转换为光照强度数据。

---

### 3. 主函数代码实现

主程序代码通过无限循环实时监测温度与光照值，结合公式计算数据并控制 GPIO 引脚的输出。实现以下功能：

- 当温度高于 30 摄氏度时，GPIO1 高电平触发 LED 灯亮起（警报灯）。
- 当光照低于 10 单位时，GPIO2 高电平触发 LED 灯亮起（补光灯）。

---

### 4. 编译与构造配置

- 编写 `BUILD.gn` 文件配置子模块编译。
- 确保传感器驱动模块与应用模块的独立性和可扩展性。

---

### 5. 烧录与运行调试

1. 将编译后的二进制文件烧录到 Tiger 开发板中。
2. 启动设备，运行程序，观察 LED 灯的状态变化：
   - 温度超过 30°C，LED1 亮起；
   - 光照不足，LED2 亮起。

---

## 系统运行结果

- **温度报警**  
  当检测到温度值超出阈值时，警报灯（LED1）亮起。

- **光照补光**  
  当光强低于设定值时，补光灯（LED2）亮起。

---

## 文件结构

```
├── BUILD.gn            // 编译构建配置文件
├── main.c              // 主程序入口
├── um_adc.c            // ADC通信相关实现
├── um_adc.h            // ADC头文件
├── um_gpio.c           // GPIO控制相关实现
├── um_gpio.h           // GPIO头文件
└── README.md           // 项目说明文件
```

---

## 注意事项

1. 确保传感器与开发板连接正确，避免短路。
2. 烧录程序前，检查编译是否通过，无报错信息。
3. 根据实际需要调整 `TEMP_CONST` 和 `LIGTH_CONST` 的计算参数。
